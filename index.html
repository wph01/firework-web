<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 关键：移动端视口设置 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>移动端绚丽烟花特效</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* 移除点击高亮 */
        }

        body {
            overflow: hidden;
            background: #000;
            height: 100vh;
            height: -webkit-fill-available; /* 适配刘海屏/底部栏 */
            cursor: pointer;
            touch-action: none; /* 禁用默认触摸行为 */
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            font-size: 14px;
            opacity: 0.8;
            pointer-events: none;
            text-align: center;
            width: 80%;
        }

        /* 适配小屏幕手机字体 */
        @media (max-width: 375px) {
            .info {
                font-size: 12px;
                top: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="info">点击/触摸屏幕发射烟花</div>
    <canvas id="fireworksCanvas"></canvas>

    <script>
        // 获取Canvas元素和上下文
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');

        // 优化：高性能的Canvas尺寸设置
        function resizeCanvas() {
            // 获取设备像素比，解决高清屏模糊问题
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();

            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);

            // 重置Canvas的CSS尺寸
            canvas.style.width = `${rect.width}px`;
            canvas.style.height = `${rect.height}px`;
        }

        // 初始化尺寸
        resizeCanvas();
        // 优化：使用被动监听提高滚动性能
        window.addEventListener('resize', resizeCanvas, { passive: true });
        window.addEventListener('orientationchange', resizeCanvas, { passive: true });

        // 随机数工具函数
        function random(min, max) {
            return Math.random() * (max - min) + min;
        }

        // 颜色工具函数 - 生成随机烟花颜色
        function randomColor() {
            const colors = [
                '#ff0043', '#00e5ff', '#ffeb3b', '#7c4dff', '#00ff9d',
                '#ff9800', '#f06292', '#9c27b0', '#2196f3', '#4caf50'
            ];
            return colors[Math.floor(random(0, colors.length))];
        }

        // 优化：粒子类 - 降低移动端粒子数量和速度，提升性能
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.speed = random(0.8, 3.5); // 降低速度适配手机
                this.angle = random(0, Math.PI * 2);
                this.gravity = 0.04; // 轻微降低重力
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.alpha = 1;
                this.decay = random(0.008, 0.012);
                this.color = color;
            }

            update() {
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 1.5, 0, Math.PI * 2); // 减小粒子尺寸
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }
        }

        // 优化：烟花类 - 适配移动端性能
        class Firework {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.color = randomColor();
                this.particles = [];
                this.particleCount = random(60, 100); // 减少粒子数量提升性能
                this.createParticles();
            }

            createParticles() {
                for (let i = 0; i < this.particleCount; i++) {
                    this.particles.push(new Particle(this.x, this.y, this.color));
                }
            }

            update() {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.update();

                    if (particle.alpha <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            }

            draw() {
                this.particles.forEach(particle => {
                    particle.draw();
                });
            }
        }

        // 存储所有烟花
        let fireworks = [];
        // 优化：防止重复触发
        let isTouching = false;

        // 优化：高性能动画循环
        function animate() {
            // 优化重绘方式
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
            ctx.fillRect(0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1));

            // 限制同时存在的烟花数量，防止卡顿
            if (fireworks.length > 8) {
                fireworks.shift();
            }

            for (let i = fireworks.length - 1; i >= 0; i--) {
                const firework = fireworks[i];
                firework.update();
                firework.draw();

                if (firework.particles.length === 0) {
                    fireworks.splice(i, 1);
                }
            }

            requestAnimationFrame(animate);
        }

        // 核心：适配移动端触摸事件
        function launchFirework(x, y) {
            fireworks.push(new Firework(x, y));
        }

        // 触摸开始
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // 阻止默认滚动
            if (isTouching) return;
            isTouching = true;

            const touch = e.touches[0];
            launchFirework(touch.clientX, touch.clientY);
        }, { passive: false });

        // 触摸移动（滑动也能发射）
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            launchFirework(touch.clientX, touch.clientY);
        }, { passive: false });

        // 触摸结束
        canvas.addEventListener('touchend', () => {
            isTouching = false;
        }, { passive: true });

        // 兼容点击事件（PC和手机都能用）
        canvas.addEventListener('click', (e) => {
            launchFirework(e.clientX, e.clientY);
        }, { passive: true });

        // 优化：降低自动发射频率，适配手机性能
        setInterval(() => {
            if (Math.random() > 0.7 && fireworks.length < 5) {
                launchFirework(
                    random(30, window.innerWidth - 30),
                    random(30, window.innerHeight - 30)
                );
            }
        }, 2500);

        // 启动动画
        animate();

        // 页面加载完成后再显示，避免初始闪烁
        window.addEventListener('load', () => {
            document.body.style.opacity = 1;
        });
    </script>
</body>
</html>